@inject ITodosClient TodosClient
@inject ISnackbar Snackbar

<EditForm Model="@this" OnValidSubmit="async () => await submitButton.InvokeHandler(Submit)">
    <DataAnnotationsValidator />

    <MudDialog>
        <DialogContent>
            <MudTextField Label="Title" Lines="3" Variant="@Variant.Outlined" @bind-Value="Title" For="() => Title" HelperText="What is this todo about?" />
        </DialogContent>
        <DialogActions>
            <MudButton OnClick="Cancel">Cancel</MudButton>
            <MudLoadingButton @ref="submitButton" ButtonType="ButtonType.Submit" Color="Color.Primary">Add</MudLoadingButton>
        </DialogActions>
    </MudDialog>
</EditForm>


@code {
    MudLoadingButton submitButton = default!;

    [Parameter]
    [Required]
    public string Title { get; set; } = default!;

    [CascadingParameter] MudDialogInstance MudDialog { get; set; } = default!;

    async Task Submit()
    {
        #if DEBUG
        await Task.Delay(1000);
        #endif

        try
        { 
            //throw new Exception();

            var todo = await TodosClient.AddTodoAsync(new AddTodoRequest()
            {
                Title = Title
            });

            MudDialog.Close(DialogResult.Ok(todo));
        }
        catch
        {
            Snackbar.Add("Todo could not be added", Severity.Error);
        }
    }

    void Cancel() => MudDialog.Cancel();
}